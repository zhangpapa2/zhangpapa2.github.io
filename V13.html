<html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>源诺鞋材来料入库系统</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <!-- 统一的 Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#64748b',
                        accent: '#0ea5e9',
                        success: '#22c55e',
                        warning: '#f59e0b',
                        danger: '#ef4444',
                        light: '#f8fafc',
                        dark: '#1e293b'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'pulse-light': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .glass-effect {
                @apply bg-white bg-opacity-20 backdrop-blur-lg;
            }
            .btn-primary {
                @apply bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center gap-2;
            }
            .btn-secondary {
                @apply bg-secondary hover:bg-secondary/90 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center gap-2;
            }
            .btn-accent {
                @apply bg-accent hover:bg-accent/90 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center gap-2;
            }
            .btn-danger {
                @apply bg-danger hover:bg-danger/90 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center gap-2;
            }
            .input-field {
                @apply w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-300;
            }
            .select-field {
                @apply w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-300 appearance-none bg-white;
            }
            .card {
                @apply bg-white rounded-xl shadow-md p-4 mb-4 overflow-hidden transition-all duration-300 hover:shadow-lg;
            }
            .badge {
                @apply px-2 py-1 text-xs font-medium rounded-full;
            }
            .badge-success {
                @apply bg-success/20 text-success;
            }
            .badge-warning {
                @apply bg-warning/20 text-warning;
            }
            .badge-danger {
                @apply bg-danger/20 text-danger;
            }
            .tab-active {
                @apply border-b-2 border-primary text-primary;
            }
            .number-btn {
                @apply relative w-full aspect-square rounded-lg bg-white border border-gray-200 flex items-center justify-center text-lg font-medium text-gray-800 hover:bg-gray-50 active:bg-gray-100 transition-all duration-200 shadow-sm;
            }
            .number-btn-selected {
                @apply bg-primary/10 border-primary;
            }
            .number-badge {
                @apply absolute -top-1.5 -right-1.5 bg-primary text-white text-sm font-bold rounded-full h-7 w-7 flex items-center justify-center cursor-pointer;
                transition: background-color 0.2s;
            }
            .number-badge:hover {
                @apply bg-primary/80;
            }
            .table-header {
                @apply bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider;
            }
            .table-cell {
                @apply whitespace-nowrap px-4 py-2 text-sm text-gray-900;
            }
            .table-row {
                @apply border-b border-gray-200 hover:bg-gray-50;
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans text-gray-900">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <h1 class="text-xl font-bold text-primary flex items-center gap-2">
                <i class="fa fa-shopping-bag"></i>
                <span>源诺鞋材来料入库系统</span>
            </h1>
            <div class="flex items-center gap-2">
                <button id="exportTodayBtn" class="btn-secondary text-sm">
                    <i class="fa fa-download"></i>
                    <span>导出今日</span>
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 py-6">
        <!-- 历史记录查询面板 (默认隐藏) -->
        <section id="historyPanel" class="hidden mb-6">
            <div class="card">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-bold text-gray-800">历史记录查询</h2>
                    <button id="closeHistoryBtn" class="text-gray-500 hover:text-gray-700">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">货品类型</label>
                        <select id="historyTypeFilter" class="select-field">
                            <option value="">全部</option>
                            <option value="MD">MD</option>
                            <option value="RB">RB</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">型体</label>
                        <select id="historyModelFilter" class="select-field">
                            <option value="">全部</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">颜色</label>
                        <select id="historyColorFilter" class="select-field">
                            <option value="">全部</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">号码</label>
                        <select id="historySizeFilter" class="select-field">
                            <option value="">全部</option>
                            <!-- 号码选项将通过JS动态添加 -->
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">日期范围</label>
                        <div class="flex gap-2">
                            <input type="date" id="historyStartDate" class="input-field">
                            <input type="date" id="historyEndDate" class="input-field">
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end gap-2">
                    <button id="searchHistoryBtn" class="btn-primary">
                        <i class="fa fa-search"></i>
                        <span>查询</span>
                    </button>
                    <button id="exportHistoryExcelBtn" class="btn-primary">
                        <i class="fa fa-file-excel-o"></i>
                        <span>导出Excel</span>
                    </button>
                </div>
                
                <div id="historyResults" class="mt-6 max-h-[400px] overflow-y-auto">
                    <!-- 历史记录结果将通过JS动态添加 -->
                </div>
            </div>
        </section>

        <!-- 快速录入区域 -->
        <section id="quickEntrySection" class="mb-6">
            <div class="card">
                <h2 class="text-lg font-bold text-gray-800 mb-4">快速录入</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">货品类型</label>
                        <select id="entryType" class="select-field">
                            <option value="MD">MD</option>
                            <option value="RB">RB</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">型体</label>
                        <div class="flex gap-2">
                            <div class="relative flex-1">
                                <input type="text" id="entryModel" class="select-field w-full pr-8" list="modelDataList" placeholder="输入或选择型体">
                                <button id="clearModelBtn" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                    <i class="fa fa-times-circle"></i>
                                </button>
                            </div>
                            <button id="addModelBtn" class="btn-secondary whitespace-nowrap">
                                <i class="fa fa-plus"></i>
                                <span>新增</span>
                            </button>
                            <button id="deleteModelBtn" class="btn-danger whitespace-nowrap">
                                <i class="fa fa-trash"></i>
                                <span>删除</span>
                            </button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">颜色</label>
                        <div class="flex gap-2">
                            <div class="relative flex-1">
                                <input type="text" id="entryColor" class="select-field w-full pr-8" list="colorDataList" placeholder="输入或选择颜色">
                                <button id="clearColorBtn" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                    <i class="fa fa-times-circle"></i>
                                </button>
                            </div>
                            <button id="addColorBtn" class="btn-secondary whitespace-nowrap">
                                <i class="fa fa-plus"></i>
                                <span>新增</span>
                            </button>
                            <button id="deleteColorBtn" class="btn-danger whitespace-nowrap">
                                <i class="fa fa-trash"></i>
                                <span>删除</span>
                            </button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">每箱数量</label>
                        <input type="number" id="entryBoxQuantity" class="input-field" min="1" value="27">
                    </div>
                </div>
                
                <div class="mb-4">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-md font-medium text-gray-700">选择号码</h3>
                        <div class="text-sm text-gray-500">
                            已选: <span id="selectedCount">0</span> 个号码
                        </div>
                    </div>
                    
                    <div id="sizeButtons" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-8 gap-2">
                        <!-- 号码按钮将通过JS动态添加 -->
                    </div>
                </div>
                
                <div class="flex justify-end gap-2">
                    <button id="resetEntryBtn" class="btn-secondary">
                        <i class="fa fa-refresh"></i>
                        <span>重置</span>
                    </button>
                    <button id="confirmEntryBtn" class="btn-primary">
                        <i class="fa fa-check"></i>
                        <span>确认录入</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- 当日数据展示区域 -->
        <section id="todayDataSection">
            <div class="card">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-bold text-gray-800">当日数据</h2>
                    <div class="text-sm text-gray-500">
                        <span id="currentDate"></span>
                    </div>
                </div>
                
                <div id="todayDataContainer" class="overflow-x-auto">
                    <!-- 当日数据将通过JS动态添加为矩阵式表格 -->
                    <div class="text-center py-8 text-gray-500">
                        暂无当日数据
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 底部操作栏 -->
    <footer class="bg-white shadow-sm mt-auto py-3 sticky bottom-0 z-40">
        <div class="container mx-auto px-4">
            <div class="flex justify-around">
                <button id="quickEntryTab" class="tab-active flex flex-col items-center justify-center py-2 px-4 w-1/3">
                    <i class="fa fa-plus-circle text-lg"></i>
                    <span class="text-xs mt-1">快速录入</span>
                </button>
                <button id="todayDataTab" class="flex flex-col items-center justify-center py-2 px-4 w-1/3">
                    <i class="fa fa-table text-lg"></i>
                    <span class="text-xs mt-1">当日数据</span>
                </button>
                <button id="historyTab" class="flex flex-col items-center justify-center py-2 px-4 w-1/3">
                    <i class="fa fa-history text-lg"></i>
                    <span class="text-xs mt-1">历史记录</span>
                </button>
            </div>
        </div>
    </footer>

    <!-- 新增型体模态框 -->
    <div id="addModelModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-md mx-4">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-800">新增型体</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">型体编号</label>
                <input type="text" id="newModelInput" class="input-field" placeholder="请输入型体编号">
            </div>
            <div class="flex justify-end">
                <button class="btn-primary" id="saveModelBtn">
                    <i class="fa fa-save"></i>
                    <span>保存</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 新增颜色模态框 -->
    <div id="addColorModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-md mx-4">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-800">新增颜色</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">颜色名称</label>
                <input type="text" id="newColorInput" class="input-field" placeholder="请输入颜色名称">
            </div>
            <div class="flex justify-end">
                <button class="btn-primary" id="saveColorBtn">
                    <i class="fa fa-save"></i>
                    <span>保存</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 编辑数据模态框 -->
    <div id="editTodayDataModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-lg mx-4">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-800">编辑数据</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="mb-4">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">货品类型</label>
                        <input type="text" id="editType" class="input-field" readonly="">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">型体</label>
                        <input type="text" id="editModel" class="input-field" readonly="">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">颜色</label>
                        <input type="text" id="editColor" class="input-field" readonly="">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">每箱数量</label>
                        <input type="number" id="editBoxQuantity" class="input-field" min="1">
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">号码数量</label>
                    <div id="editSizeQuantities" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2">
                        <!-- 号码数量编辑框将通过JS动态添加 -->
                    </div>
                </div>
                
                <div class="flex justify-between items-center">
                    <div>
                        <span class="text-sm font-medium text-gray-700">总箱数: </span>
                        <span id="editTotalBoxes" class="text-sm font-bold">0</span>
                    </div>
                    <div>
                        <span class="text-sm font-medium text-gray-700">总数量: </span>
                        <span id="editTotalQuantity" class="text-sm font-bold">0</span>
                    </div>
                </div>
            </div>
            <div class="flex justify-end gap-2">
                <button class="btn-danger" id="deleteTodayDataBtn">
                    <i class="fa fa-trash"></i>
                    <span>删除</span>
                </button>
                <button class="btn-primary" id="saveTodayDataBtn">
                    <i class="fa fa-save"></i>
                    <span>保存</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 确认对话框 -->
    <div id="confirmDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-bold text-gray-800 mb-4" id="confirmDialogTitle">确认操作</h3>
            <p class="text-gray-600 mb-6" id="confirmDialogMessage">您确定要执行此操作吗？</p>
            <div class="flex justify-end gap-2">
                <button class="btn-secondary" id="cancelConfirmBtn">
                    <span>取消</span>
                </button>
                <button class="btn-primary" id="confirmBtn">
                    <span>确认</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- 录入预览模态框 -->
    <div id="entryPreviewModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-lg mx-4 max-h-[80vh] flex flex-col">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-800">录入预览</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            
            <div class="mb-4 flex-grow overflow-y-auto">
                <div class="bg-gray-50 p-4 rounded-lg mb-4">
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <p class="text-sm text-gray-500">货品类型</p>
                            <p class="font-medium" id="previewType"></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">型体</p>
                            <p class="font-medium" id="previewModel"></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">颜色</p>
                            <p class="font-medium" id="previewColor"></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">每箱数量</p>
                            <p class="font-medium" id="previewBoxQuantity"></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">总箱数</p>
                            <p class="font-medium" id="previewTotalBoxes"></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">总数量</p>
                            <p class="font-medium" id="previewTotalQuantity"></p>
                        </div>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full border-collapse">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="border border-gray-200 px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">号码</th>
                                <th class="border border-gray-200 px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">箱数</th>
                                <th class="border border-gray-200 px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">数量</th>
                            </tr>
                        </thead>
                        <tbody id="previewSizeTable" class="bg-white divide-y divide-gray-200">
                            <!-- 号码数据将通过JS动态添加 -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="flex justify-end gap-2 mt-4">
                <button class="btn-secondary close-modal">
                    <span>取消</span>
                </button>
                <button class="btn-primary" id="confirmEntryPreviewBtn">
                    <i class="fa fa-check"></i>
                    <span>确认录入</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 提示消息 -->
    <div id="toast" class="fixed top-4 right-4 bg-white rounded-lg shadow-lg p-4 max-w-xs transform translate-x-full transition-transform duration-300 z-50 flex items-center gap-3">
        <div id="toastIcon" class="text-lg"></div>
        <div>
            <h4 id="toastTitle" class="font-medium text-gray-800"></h4>
            <p id="toastMessage" class="text-sm text-gray-600"></p>
        </div>
    </div>

    <script>
        // 全局数据存储
        const dataStore = {
            // 预设号码
            sizes: ['5', '5.5', '6', '6.5', '7', '7.5', '8', '8.5', '9', '9.5', '10', '10.5', '11', '11.5', '12', '12.5'],
            
            // 预设型体
            models: ['25430', '25431', '25432', '25433', '25434'],
            
            // 预设颜色
            colors: ['白色', '黑色', '红色', '蓝色', '灰色'],
            
            // 当前录入的号码数量
            currentEntry: {},
            
            // 当日数据
            todayData: [],
            
            // 历史数据
            historyData: [],
            
            // 初始化函数
            init() {
                // 从本地存储加载数据
                this.loadFromLocalStorage();
                
                // 初始化当前录入数据
                this.resetCurrentEntry();
                
                // 更新UI
                this.updateSizeButtons();
                this.updateModelSelect();
                this.updateColorSelect();
                this.updateTodayDataTable();
                this.updateHistoryFilters();
                this.updateCurrentDate();
            },
            
            // 从本地存储加载数据
            loadFromLocalStorage() {
                // 加载型体
                const savedModels = localStorage.getItem('shoeInventory_models');
                if (savedModels) {
                    this.models = JSON.parse(savedModels);
                }
                
                // 加载颜色
                const savedColors = localStorage.getItem('shoeInventory_colors');
                if (savedColors) {
                    this.colors = JSON.parse(savedColors);
                }
                
                // 加载当日数据
                const todayKey = this.getTodayKey();
                const savedTodayData = localStorage.getItem(todayKey);
                if (savedTodayData) {
                    this.todayData = JSON.parse(savedTodayData);
                }
                
                // 加载历史数据
                const savedHistoryData = localStorage.getItem('shoeInventory_historyData');
                if (savedHistoryData) {
                    this.historyData = JSON.parse(savedHistoryData);
                }
            },
            
            // 保存数据到本地存储
            saveToLocalStorage() {
                // 保存型体
                localStorage.setItem('shoeInventory_models', JSON.stringify(this.models));
                
                // 保存颜色
                localStorage.setItem('shoeInventory_colors', JSON.stringify(this.colors));
                
                // 保存当日数据
                const todayKey = this.getTodayKey();
                localStorage.setItem(todayKey, JSON.stringify(this.todayData));
                
                // 保存历史数据
                localStorage.setItem('shoeInventory_historyData', JSON.stringify(this.historyData));
            },
            
            // 获取今日数据的本地存储键
            getTodayKey() {
                const today = new Date();
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                return `shoeInventory_todayData_${year}${month}${day}`;
            },
            
            // 获取当前日期字符串
            getCurrentDateString() {
                const today = new Date();
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            },
            
            // 重置当前录入数据
            resetCurrentEntry() {
                this.currentEntry = {
                    type: 'MD',
                    model: this.models[0] || '',
                    color: this.colors[0] || '',
                    boxQuantity: 27,
                    sizes: {}
                };
                
                // 初始化所有号码数量为0
                this.sizes.forEach(size => {
                    this.currentEntry.sizes[size] = 0;
                });
            },
            
            // 更新号码按钮UI
            updateSizeButtons() {
                const sizeButtonsContainer = document.getElementById('sizeButtons');
                sizeButtonsContainer.innerHTML = '';
                
                this.sizes.forEach(size => {
                    const count = this.currentEntry.sizes[size] || 0;
                    const button = document.createElement('button');
                    button.className = `number-btn ${count > 0 ? 'number-btn-selected' : ''}`;
                    button.dataset.size = size;
                    button.innerHTML = `
                        <span class="size-text">${size}</span>
                        ${count > 0 ? `<span class="number-badge" data-size="${size}">${count}</span>` : ''}
                    `;
                    
                    // 点击按钮主体增加数量
                    button.addEventListener('click', (e) => {
                        // 如果点击的是徽章区域，则不执行增加操作
                        if (!e.target.closest('.number-badge')) {
                            this.incrementSizeQuantity(size);
                        }
                    });
                    
                    // 点击徽章区域减少数量
                    const badge = button.querySelector('.number-badge');
                    if (badge) {
                        badge.addEventListener('click', (e) => {
                            e.stopPropagation(); // 阻止事件冒泡到按钮
                            this.decrementSizeQuantity(size);
                        });
                    }
                    
                    sizeButtonsContainer.appendChild(button);
                });
                
                // 更新已选号码计数
                this.updateSelectedCount();
            },
            
            // 增加号码数量
            incrementSizeQuantity(size) {
                if (!this.currentEntry.sizes[size]) {
                    this.currentEntry.sizes[size] = 0;
                }
                this.currentEntry.sizes[size]++;
                this.updateSizeButtons();
            },
            
            // 减少号码数量
            decrementSizeQuantity(size) {
                if (this.currentEntry.sizes[size] > 0) {
                    this.currentEntry.sizes[size]--;
                    this.updateSizeButtons();
                }
            },
            
            // 更新已选号码计数
            updateSelectedCount() {
                const selectedCount = Object.values(this.currentEntry.sizes).filter(count => count > 0).length;
                document.getElementById('selectedCount').textContent = selectedCount;
            },
            
            // 更新型体选择框
            updateModelSelect() {
                const modelSelect = document.getElementById('entryModel');
                const modelDataList = document.getElementById('modelDataList') || document.createElement('datalist');
                const historyModelFilter = document.getElementById('historyModelFilter');
                
                // 确保datalist有id并添加到文档中
                if (!modelDataList.id) {
                    modelDataList.id = 'modelDataList';
                    document.body.appendChild(modelDataList);
                }
                
                // 清空现有选项
                modelDataList.innerHTML = '';
                historyModelFilter.innerHTML = '<option value="">全部</option>';
                
                // 添加型体选项到datalist
                this.models.forEach(model => {
                    const option1 = document.createElement('option');
                    option1.value = model;
                    option1.textContent = model;
                    modelDataList.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = model;
                    option2.textContent = model;
                    historyModelFilter.appendChild(option2);
                });
                
                // 确保输入框关联到datalist
                modelSelect.setAttribute('list', 'modelDataList');
                
                // 如果当前录入的型体不存在于列表中，不强制更新，可以使用自定义输入值
                if (this.currentEntry.model && !this.models.includes(this.currentEntry.model)) {
                    // 允许自定义值，不再强制设置为第一个选项
                }
            },
            
            // 更新颜色选择框
            updateColorSelect() {
                const colorSelect = document.getElementById('entryColor');
                const colorDataList = document.getElementById('colorDataList') || document.createElement('datalist');
                const historyColorFilter = document.getElementById('historyColorFilter');
                
                // 确保datalist有id并添加到文档中
                if (!colorDataList.id) {
                    colorDataList.id = 'colorDataList';
                    document.body.appendChild(colorDataList);
                }
                
                // 清空现有选项
                colorDataList.innerHTML = '';
                historyColorFilter.innerHTML = '<option value="">全部</option>';
                
                // 添加颜色选项到datalist
                this.colors.forEach(color => {
                    const option1 = document.createElement('option');
                    option1.value = color;
                    option1.textContent = color;
                    colorDataList.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = color;
                    option2.textContent = color;
                    historyColorFilter.appendChild(option2);
                });
                
                // 确保输入框关联到datalist
                colorSelect.setAttribute('list', 'colorDataList');
                
                // 如果当前录入的颜色不存在于列表中，不强制更新，可以使用自定义输入值
                if (this.currentEntry.color && !this.colors.includes(this.currentEntry.color)) {
                    // 允许自定义值，不再强制设置为第一个选项
                }
            },
            
            // 更新历史记录筛选器
            updateHistoryFilters() {
                const historySizeFilter = document.getElementById('historySizeFilter');
                
                // 清空现有选项
                historySizeFilter.innerHTML = '<option value="">全部</option>';
                
                // 添加号码选项
                this.sizes.forEach(size => {
                    const option = document.createElement('option');
                    option.value = size;
                    option.textContent = size;
                    historySizeFilter.appendChild(option);
                });
                
                // 设置日期范围默认值为最近7天
                const today = new Date();
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(today.getDate() - 7);
                
                document.getElementById('historyEndDate').valueAsDate = today;
                document.getElementById('historyStartDate').valueAsDate = oneWeekAgo;
            },
            
            // 更新当前日期显示
            updateCurrentDate() {
                const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
                const today = new Date();
                document.getElementById('currentDate').textContent = today.toLocaleDateString('zh-CN', options);
            },
            
            // 添加新的型体
            addModel(model) {
                if (!model || this.models.includes(model)) {
                    return false;
                }
                
                this.models.push(model);
                this.saveToLocalStorage();
                this.updateModelSelect();
                return true;
            },
            
            // 删除型体
            deleteModel(model) {
                const index = this.models.indexOf(model);
                if (index === -1) {
                    return false;
                }
                
                // 检查是否有相关的入库记录
                const hasRelatedRecords = this.todayData.some(entry => entry.model === model) || 
                                         this.historyData.some(entry => entry.model === model);
                
                if (hasRelatedRecords) {
                    return false; // 有相关记录，不允许删除
                }
                
                this.models.splice(index, 1);
                this.saveToLocalStorage();
                this.updateModelSelect();
                
                // 如果当前录入的型体被删除，更新为第一个型体
                if (this.currentEntry.model === model) {
                    this.currentEntry.model = this.models[0] || '';
                }
                
                return true;
            },
            
            // 添加新的颜色
            addColor(color) {
                if (!color || this.colors.includes(color)) {
                    return false;
                }
                
                this.colors.push(color);
                this.saveToLocalStorage();
                this.updateColorSelect();
                return true;
            },
            
            // 删除颜色
            deleteColor(color) {
                const index = this.colors.indexOf(color);
                if (index === -1) {
                    return false;
                }
                
                // 检查是否有相关的入库记录
                const hasRelatedRecords = this.todayData.some(entry => entry.color === color) || 
                                         this.historyData.some(entry => entry.color === color);
                
                if (hasRelatedRecords) {
                    return false; // 有相关记录，不允许删除
                }
                
                this.colors.splice(index, 1);
                this.saveToLocalStorage();
                this.updateColorSelect();
                
                // 如果当前录入的颜色被删除，更新为第一个颜色
                if (this.currentEntry.color === color) {
                    this.currentEntry.color = this.colors[0] || '';
                }
                
                return true;
            },
            
            // 确认录入数据
            confirmEntry() {
                // 检查是否有选择号码
                const hasSizes = Object.values(this.currentEntry.sizes).some(count => count > 0);
                if (!hasSizes) {
                    return false;
                }
                
                // 创建新的入库记录
                const newEntry = {
                    type: this.currentEntry.type,
                    model: this.currentEntry.model,
                    color: this.currentEntry.color,
                    boxQuantity: this.currentEntry.boxQuantity,
                    sizes: { ...this.currentEntry.sizes },
                    totalBoxes: 0,
                    totalQuantity: 0,
                    timestamp: new Date().toISOString()
                };
                
                // 计算总箱数和总数量
                newEntry.totalBoxes = Object.values(newEntry.sizes).reduce((sum, count) => sum + count, 0);
                newEntry.totalQuantity = newEntry.totalBoxes * newEntry.boxQuantity;
                
                // 添加到当日数据
                this.todayData.push(newEntry);
                
                // 添加到历史数据
                this.historyData.push(newEntry);
                
                // 保存数据
                this.saveToLocalStorage();
                
                // 更新UI
                this.updateTodayDataTable();
                
                // 重置当前录入
                this.resetCurrentEntry();
                this.updateSizeButtons();
                
                return true;
            },
            
            // 更新当日数据表格
            updateTodayDataTable() {
                const tableContainer = document.getElementById('todayDataContainer');
                
                // 如果没有数据，显示提示信息
                if (this.todayData.length === 0) {
                    tableContainer.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            暂无当日数据
                        </div>
                    `;
                    return;
                }
                
                // 按型体和颜色分组数据
                const groupedData = this.groupDataByModelAndColor();
                
                // 创建表格
                const table = document.createElement('table');
                table.className = 'min-w-full border-collapse';
                
                // 创建表头
                const thead = document.createElement('thead');
                thead.className = 'bg-gray-100';
                
                // 创建表头行
                const headerRow = document.createElement('tr');
                
                // 添加固定列标题
                headerRow.innerHTML = `
                    <th class="border border-gray-200 px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">货品类型</th>
                    <th class="border border-gray-200 px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">型体</th>
                    <th class="border border-gray-200 px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">颜色</th>
                `;
                
                // 添加号码列标题
                this.sizes.forEach(size => {
                    const th = document.createElement('th');
                    th.className = 'border border-gray-200 px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider';
                    th.textContent = size;
                    headerRow.appendChild(th);
                });
                
                // 添加总计列标题
                const totalTh = document.createElement('th');
                totalTh.className = 'border border-gray-200 px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider';
                totalTh.textContent = '总计';
                headerRow.appendChild(totalTh);
                
                thead.appendChild(headerRow);
                table.appendChild(thead);
                
                // 创建表体
                const tbody = document.createElement('tbody');
                
                // 添加数据行
                let totalTodayQuantity = 0;
                
                for (const [model, colorGroups] of Object.entries(groupedData)) {
                    for (const [color, entries] of Object.entries(colorGroups)) {
                        // 计算该型体颜色组合的总箱数和总数量
                        let totalBoxes = 0;
                        let totalQuantity = 0;
                        const sizeDetails = {};
                        
                        entries.forEach(entry => {
                            totalBoxes += entry.totalBoxes;
                            totalQuantity += entry.totalQuantity;
                            totalTodayQuantity += entry.totalQuantity;
                            
                            // 合并每个号码的数量
                            for (const [size, count] of Object.entries(entry.sizes)) {
                                if (count > 0) {
                                    if (!sizeDetails[size]) {
                                        sizeDetails[size] = {
                                            boxes: 0,
                                            quantity: 0,
                                            boxQuantity: entry.boxQuantity
                                        };
                                    }
                                    sizeDetails[size].boxes += count;
                                    sizeDetails[size].quantity += count * entry.boxQuantity;
                                }
                            }
                        });
                        
                        // 创建数据行
                        const dataRow = document.createElement('tr');
                        dataRow.className = 'bg-white hover:bg-gray-50';
                        
                        // 添加固定列数据
                        dataRow.innerHTML = `
                            <td class="border border-gray-200 px-3 py-2 text-sm font-medium text-gray-900">${entries[0].type}</td>
                            <td class="border border-gray-200 px-3 py-2 text-sm font-medium text-gray-900">${model}</td>
                            <td class="border border-gray-200 px-3 py-2 text-sm font-medium text-gray-900">${color}</td>
                        `;
                        
                        // 添加号码列数据
                        this.sizes.forEach(size => {
                            const td = document.createElement('td');
                            td.className = 'border border-gray-200 px-3 py-2 text-center text-sm text-gray-900';
                            
                            if (sizeDetails[size]) {
                                td.textContent = sizeDetails[size].quantity;
                            } else {
                                td.textContent = '';
                            }
                            
                            dataRow.appendChild(td);
                        });
                        
                        // 添加总计列数据
                        const totalTd = document.createElement('td');
                        totalTd.className = 'border border-gray-200 px-3 py-2 text-center text-sm font-medium text-gray-900';
                        totalTd.textContent = totalQuantity;
                        dataRow.appendChild(totalTd);
                        
                        // 操作列已完全移除，不再添加任何操作列相关内容
                        
                        tbody.appendChild(dataRow);
                    }
                }
                
                // 添加总计行
                const totalRow = document.createElement('tr');
                totalRow.className = 'bg-blue-50';
                totalRow.innerHTML = `
                    <td class="border border-gray-200 px-3 py-2 text-sm font-bold text-gray-900" colspan="3">今日总计</td>
                `;
                
                // 计算每个号码的总计
                const sizeTotals = {};
                this.sizes.forEach(size => {
                    sizeTotals[size] = 0;
                });
                
                // 遍历所有数据计算每个号码的总计
                for (const [model, colorGroups] of Object.entries(groupedData)) {
                    for (const [color, entries] of Object.entries(colorGroups)) {
                        entries.forEach(entry => {
                            for (const [size, count] of Object.entries(entry.sizes)) {
                                if (count > 0) {
                                    sizeTotals[size] += count * entry.boxQuantity;
                                }
                            }
                        });
                    }
                }
                
                // 添加每个号码的总计
                this.sizes.forEach(size => {
                    const td = document.createElement('td');
                    td.className = 'border border-gray-200 px-3 py-2 text-center text-sm font-bold text-gray-900';
                    td.textContent = sizeTotals[size];
                    totalRow.appendChild(td);
                });
                
                // 添加总总计
                const totalTd = document.createElement('td');
                totalTd.className = 'border border-gray-200 px-3 py-2 text-center text-sm font-bold text-gray-900';
                totalTd.textContent = totalTodayQuantity;
                totalRow.appendChild(totalTd);
                
                // 操作列已移除，不再需要添加总计行的操作列
                
                tbody.appendChild(totalRow);
                table.appendChild(tbody);
                
                // 清空容器并添加新表格
                tableContainer.innerHTML = '';
                tableContainer.appendChild(table);
            },
            
            // 按型体和颜色分组数据
            groupDataByModelAndColor() {
                const grouped = {};
                
                this.todayData.forEach(entry => {
                    if (!grouped[entry.model]) {
                        grouped[entry.model] = {};
                    }
                    
                    if (!grouped[entry.model][entry.color]) {
                        grouped[entry.model][entry.color] = [];
                    }
                    
                    grouped[entry.model][entry.color].push(entry);
                });
                
                return grouped;
            },
            
            // 编辑当日数据
            editTodayData(index, updatedEntry) {
                if (index >= 0 && index < this.todayData.length) {
                    // 更新历史数据中对应的记录
                    const originalEntry = this.todayData[index];
                    const historyIndex = this.historyData.findIndex(item => item.timestamp === originalEntry.timestamp);
                    
                    if (historyIndex !== -1) {
                        this.historyData[historyIndex] = { ...updatedEntry };
                    }
                    
                    // 更新当日数据
                    this.todayData[index] = { ...updatedEntry };
                    
                    // 保存数据
                    this.saveToLocalStorage();
                    
                    // 更新UI
                    this.updateTodayDataTable();
                    
                    return true;
                }
                
                return false;
            },
            
            // 删除当日数据
            deleteTodayData(index) {
                if (index >= 0 && index < this.todayData.length) {
                    // 从历史数据中删除对应的记录
                    const entry = this.todayData[index];
                    const historyIndex = this.historyData.findIndex(item => item.timestamp === entry.timestamp);
                    
                    if (historyIndex !== -1) {
                        this.historyData.splice(historyIndex, 1);
                    }
                    
                    // 从当日数据中删除
                    this.todayData.splice(index, 1);
                    
                    // 保存数据
                    this.saveToLocalStorage();
                    
                    // 更新UI
                    this.updateTodayDataTable();
                    
                    return true;
                }
                
                return false;
            },
            
            // 查询历史记录
            searchHistory(type, model, color, size, startDate, endDate) {
                let results = [...this.historyData];
                
                // 筛选类型
                if (type) {
                    results = results.filter(item => item.type === type);
                }
                
                // 筛选型体
                if (model) {
                    results = results.filter(item => item.model === model);
                }
                
                // 筛选颜色
                if (color) {
                    results = results.filter(item => item.color === color);
                }
                
                // 筛选号码
                if (size) {
                    results = results.filter(item => item.sizes[size] > 0);
                }
                
                // 筛选日期范围
                if (startDate) {
                    const start = new Date(startDate);
                    start.setHours(0, 0, 0, 0);
                    results = results.filter(item => new Date(item.timestamp) >= start);
                }
                
                if (endDate) {
                    const end = new Date(endDate);
                    end.setHours(23, 59, 59, 999);
                    results = results.filter(item => new Date(item.timestamp) <= end);
                }
                
                // 按日期降序排序
                results.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                return results;
            },
            
            // 导出当日数据为CSV
            exportTodayDataToCSV() {
                if (this.todayData.length === 0) {
                    return null;
                }
                
                // 第一部分：详细记录数据
                let csv = '=====详细记录=====\n';
                csv += '货品类型,型体,颜色,每箱数量,号码,箱数,数量,录入时间\n';
                
                // 添加详细数据行
                this.todayData.forEach(entry => {
                    this.sizes.forEach(size => {
                        const count = entry.sizes[size] || 0;
                        if (count > 0) {
                            const quantity = count * entry.boxQuantity;
                            const date = new Date(entry.timestamp).toLocaleString('zh-CN');
                            csv += `${entry.type},${entry.model},${entry.color},${entry.boxQuantity},${size},${count},${quantity},${date}\n`;
                        }
                    });
                });
                
                // 添加空行分隔
                csv += '\n\n';
                
                // 第二部分：数据矩阵
                csv += '=====数据矩阵=====\n';
                
                // 按型体和颜色分组数据
                const groupedData = this.groupDataByModelAndColor();
                
                // 构建矩阵表头
                let matrixHeader = '货品类型,型体,颜色';
                this.sizes.forEach(size => {
                    matrixHeader += `,${size}`;
                });
                matrixHeader += ',总计\n';
                csv += matrixHeader;
                
                // 计算总计数量
                let totalTodayQuantity = 0;
                const sizeTotals = {};
                this.sizes.forEach(size => {
                    sizeTotals[size] = 0;
                });
                
                // 添加矩阵数据行
                for (const [model, colorGroups] of Object.entries(groupedData)) {
                    for (const [color, entries] of Object.entries(colorGroups)) {
                        // 计算该型体颜色组合的总数量和每个号码的数量
                        let totalQuantity = 0;
                        const sizeDetails = {};
                        
                        entries.forEach(entry => {
                            // 合并每个号码的数量
                            for (const [size, count] of Object.entries(entry.sizes)) {
                                if (count > 0) {
                                    const quantity = count * entry.boxQuantity;
                                    if (!sizeDetails[size]) {
                                        sizeDetails[size] = 0;
                                    }
                                    sizeDetails[size] += quantity;
                                    totalQuantity += quantity;
                                    totalTodayQuantity += quantity;
                                    sizeTotals[size] += quantity;
                                }
                            }
                        });
                        
                        // 创建数据行
                        let row = `${entries[0].type},${model},${color}`;
                        
                        // 添加每个号码的数量
                        this.sizes.forEach(size => {
                            row += `,${sizeDetails[size] || 0}`;
                        });
                        
                        // 添加总计
                        row += `,${totalQuantity}\n`;
                        csv += row;
                    }
                }
                
                // 添加矩阵总计行
                let totalRow = '总计,,,,';
                this.sizes.forEach(size => {
                    totalRow += `,${sizeTotals[size]}`;
                });
                totalRow += `,${totalTodayQuantity}\n`;
                csv += totalRow;
                
                return csv;
            },
            
            // 导出历史查询结果为CSV
            exportHistoryResultsToCSV(results) {
                if (!results || results.length === 0) {
                    return null;
                }
                
                // CSV头部
                let csv = '货品类型,型体,颜色,每箱数量,号码,箱数,数量,录入时间\n';
                
                // 添加数据行
                results.forEach(entry => {
                    this.sizes.forEach(size => {
                        const count = entry.sizes[size] || 0;
                        if (count > 0) {
                            const quantity = count * entry.boxQuantity;
                            const date = new Date(entry.timestamp).toLocaleString('zh-CN');
                            csv += `${entry.type},${entry.model},${entry.color},${entry.boxQuantity},${size},${count},${quantity},${date}\n`;
                        }
                    });
                });
                
                return csv;
            },
            
            // 更新历史记录 - 修复核心问题
            updateHistoryEntry(timestamp, updatedEntry) {
                // 验证输入数据
                if (!timestamp || !updatedEntry) {
                    console.error('更新历史记录失败: 缺少必要参数');
                    return false;
                }
                
                // 查找历史记录
                const historyIndex = this.historyData.findIndex(item => item.timestamp === timestamp);
                
                if (historyIndex !== -1) {
                    // 保留原始时间戳，不创建新的，以便正确关联记录
                    updatedEntry.timestamp = timestamp;
                    
                    // 更新历史记录
                    this.historyData[historyIndex] = { ...updatedEntry };
                    
                    // 检查是否在当日数据中也存在该记录
                    const todayIndex = this.todayData.findIndex(item => item.timestamp === timestamp);
                    if (todayIndex !== -1) {
                        // 更新当日数据
                        this.todayData[todayIndex] = { ...updatedEntry };
                    }
                    
                    // 保存数据
                    this.saveToLocalStorage();
                    return true;
                } else {
                    console.error(`更新历史记录失败: 未找到时间戳为 ${timestamp} 的记录`);
                    return false;
                }
            },
            
            // 删除历史记录 - 修复核心问题
            deleteHistoryEntry(timestamp) {
                // 验证输入数据
                if (!timestamp) {
                    console.error('删除历史记录失败: 缺少时间戳参数');
                    return false;
                }
                
                // 查找历史记录
                const historyIndex = this.historyData.findIndex(item => item.timestamp === timestamp);
                
                if (historyIndex !== -1) {
                    // 从历史数据中删除
                    this.historyData.splice(historyIndex, 1);
                    
                    // 检查是否在当日数据中也存在该记录
                    const todayIndex = this.todayData.findIndex(item => item.timestamp === timestamp);
                    if (todayIndex !== -1) {
                        // 从当日数据中删除
                        this.todayData.splice(todayIndex, 1);
                    }
                    
                    // 保存数据
                    this.saveToLocalStorage();
                    return true;
                } else {
                    console.error(`删除历史记录失败: 未找到时间戳为 ${timestamp} 的记录`);
                    return false;
                }
            }
        };

        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化数据存储
            dataStore.init();
            
            // 绑定事件处理函数
            bindEventHandlers();
        });

        // 绑定事件处理函数
        function bindEventHandlers() {
            // 关闭模态框按钮
            document.querySelectorAll('.close-modal').forEach(button => {
                button.addEventListener('click', () => {
                    const modal = button.closest('.fixed');
                    modal.classList.add('hidden');
                });
            });
            
            // 型体选择变化
            document.getElementById('entryModel').addEventListener('change', (e) => {
                dataStore.currentEntry.model = e.target.value;
                document.getElementById('clearModelBtn').classList.toggle('hidden', !e.target.value);
            });
            
            // 型体输入变化
            document.getElementById('entryModel').addEventListener('input', (e) => {
                dataStore.currentEntry.model = e.target.value;
                document.getElementById('clearModelBtn').classList.toggle('hidden', !e.target.value);
            });
            
            // 颜色选择变化
            document.getElementById('entryColor').addEventListener('change', (e) => {
                dataStore.currentEntry.color = e.target.value;
                document.getElementById('clearColorBtn').classList.toggle('hidden', !e.target.value);
            });
            
            // 颜色输入变化
            document.getElementById('entryColor').addEventListener('input', (e) => {
                dataStore.currentEntry.color = e.target.value;
                document.getElementById('clearColorBtn').classList.toggle('hidden', !e.target.value);
            });
            
            // 清除型体按钮
            document.getElementById('clearModelBtn').addEventListener('click', (e) => {
                e.stopPropagation(); // 防止事件冒泡
                const modelInput = document.getElementById('entryModel');
                modelInput.value = '';
                dataStore.currentEntry.model = '';
                document.getElementById('clearModelBtn').classList.add('hidden');
            });
            
            // 清除颜色按钮
            document.getElementById('clearColorBtn').addEventListener('click', (e) => {
                e.stopPropagation(); // 防止事件冒泡
                const colorInput = document.getElementById('entryColor');
                colorInput.value = '';
                dataStore.currentEntry.color = '';
                document.getElementById('clearColorBtn').classList.add('hidden');
            });
            
            // 货品类型选择变化
            document.getElementById('entryType').addEventListener('change', (e) => {
                dataStore.currentEntry.type = e.target.value;
            });
            
            // 每箱数量输入变化 - 添加input事件确保实时更新
            document.getElementById('entryBoxQuantity').addEventListener('input', (e) => {
                const value = parseInt(e.target.value) || 27;
                dataStore.currentEntry.boxQuantity = value;
            });
            
            // 保留change事件作为额外保障
            document.getElementById('entryBoxQuantity').addEventListener('change', (e) => {
                const value = parseInt(e.target.value) || 27;
                dataStore.currentEntry.boxQuantity = value;
            });
            
            // 新增型体按钮
            document.getElementById('addModelBtn').addEventListener('click', () => {
                document.getElementById('addModelModal').classList.remove('hidden');
                document.getElementById('newModelInput').value = '';
                document.getElementById('newModelInput').focus();
            });
            
            // 保存型体按钮
            document.getElementById('saveModelBtn').addEventListener('click', () => {
                const model = document.getElementById('newModelInput').value.trim();
                if (dataStore.addModel(model)) {
                    closeModal('addModelModal');
                    showToast('success', '成功', '型体添加成功');
                } else {
                    showToast('error', '失败', '型体已存在或为空');
                }
            });
            
            // 新增颜色按钮
            document.getElementById('addColorBtn').addEventListener('click', () => {
                document.getElementById('addColorModal').classList.remove('hidden');
                document.getElementById('newColorInput').value = '';
                document.getElementById('newColorInput').focus();
            });
            
            // 保存颜色按钮
            document.getElementById('saveColorBtn').addEventListener('click', () => {
                const color = document.getElementById('newColorInput').value.trim();
                if (dataStore.addColor(color)) {
                    closeModal('addColorModal');
                    showToast('success', '成功', '颜色添加成功');
                } else {
                    showToast('error', '失败', '颜色已存在或为空');
                }
            });
            
            // 删除型体按钮
            document.getElementById('deleteModelBtn').addEventListener('click', () => {
                const selectedModel = document.getElementById('entryModel').value;
                if (!selectedModel) {
                    showToast('error', '失败', '请选择要删除的型体');
                    return;
                }
                
                showConfirmDialog(
                    '确认删除型体',
                    `您确定要删除型体"${selectedModel}"吗？如果有相关的入库记录，将无法删除。`,
                    () => {
                        if (dataStore.deleteModel(selectedModel)) {
                            showToast('success', '成功', '型体删除成功');
                        } else {
                            showToast('error', '失败', '无法删除型体，可能存在相关的入库记录');
                        }
                    }
                );
            });
            
            // 删除颜色按钮
            document.getElementById('deleteColorBtn').addEventListener('click', () => {
                const selectedColor = document.getElementById('entryColor').value;
                if (!selectedColor) {
                    showToast('error', '失败', '请选择要删除的颜色');
                    return;
                }
                
                showConfirmDialog(
                    '确认删除颜色',
                    `您确定要删除颜色"${selectedColor}"吗？如果有相关的入库记录，将无法删除。`,
                    () => {
                        if (dataStore.deleteColor(selectedColor)) {
                            showToast('success', '成功', '颜色删除成功');
                        } else {
                            showToast('error', '失败', '无法删除颜色，可能存在相关的入库记录');
                        }
                    }
                );
            });
            
            // 重置录入按钮
            document.getElementById('resetEntryBtn').addEventListener('click', () => {
                dataStore.resetCurrentEntry();
                dataStore.updateSizeButtons();
            });
            
            // 确认录入按钮
            document.getElementById('confirmEntryBtn').addEventListener('click', () => {
                // 检查是否有选择号码
                const hasSizes = Object.values(dataStore.currentEntry.sizes).some(count => count > 0);
                if (!hasSizes) {
                    showToast('error', '失败', '请至少选择一个号码');
                    return;
                }
                
                // 显示录入预览模态框
                showEntryPreviewModal();
            });
            
            // 导出今日数据按钮
            document.getElementById('exportTodayBtn').addEventListener('click', () => {
                const csv = dataStore.exportTodayDataToCSV();
                if (csv) {
                    downloadCSV(csv, `鞋子入库记录_${dataStore.getCurrentDateString()}.csv`);
                    showToast('success', '成功', '数据导出成功');
                } else {
                    showToast('error', '失败', '暂无数据可导出');
                }
            });
            
            // 历史记录按钮（顶部）已删除，相关事件监听也被移除
            
            // 关闭历史记录面板按钮
            document.getElementById('closeHistoryBtn').addEventListener('click', () => {
                document.getElementById('historyPanel').classList.add('hidden');
                document.getElementById('quickEntrySection').classList.remove('hidden');
                document.getElementById('todayDataSection').classList.remove('hidden');
            });
            
            // 查询历史记录按钮
            document.getElementById('searchHistoryBtn').addEventListener('click', () => {
                const type = document.getElementById('historyTypeFilter').value;
                const model = document.getElementById('historyModelFilter').value;
                const color = document.getElementById('historyColorFilter').value;
                const size = document.getElementById('historySizeFilter').value;
                const startDate = document.getElementById('historyStartDate').value;
                const endDate = document.getElementById('historyEndDate').value;
                
                const results = dataStore.searchHistory(type, model, color, size, startDate, endDate);
                displayHistoryResults(results);
            });
            
            // 导出Excel按钮
            document.getElementById('exportHistoryExcelBtn').addEventListener('click', () => {
                const type = document.getElementById('historyTypeFilter').value;
                const model = document.getElementById('historyModelFilter').value;
                const color = document.getElementById('historyColorFilter').value;
                const size = document.getElementById('historySizeFilter').value;
                const startDate = document.getElementById('historyStartDate').value;
                const endDate = document.getElementById('historyEndDate').value;
                
                const results = dataStore.searchHistory(type, model, color, size, startDate, endDate);
                if (results.length > 0) {
                    exportToExcel(results);
                    showToast('success', '成功', 'Excel数据导出成功');
                } else {
                    showToast('error', '失败', '暂无数据可导出');
                }
            });
            
            // 底部导航标签切换
            document.getElementById('quickEntryTab').addEventListener('click', () => {
                document.getElementById('quickEntrySection').classList.remove('hidden');
                document.getElementById('todayDataSection').classList.add('hidden');
                document.getElementById('historyPanel').classList.add('hidden');
                
                document.getElementById('quickEntryTab').classList.add('tab-active');
                document.getElementById('todayDataTab').classList.remove('tab-active');
                document.getElementById('historyTab').classList.remove('tab-active');
            });
            
            document.getElementById('todayDataTab').addEventListener('click', () => {
                document.getElementById('quickEntrySection').classList.add('hidden');
                document.getElementById('todayDataSection').classList.remove('hidden');
                document.getElementById('historyPanel').classList.add('hidden');
                
                document.getElementById('quickEntryTab').classList.remove('tab-active');
                document.getElementById('todayDataTab').classList.add('tab-active');
                document.getElementById('historyTab').classList.remove('tab-active');
            });
            
            document.getElementById('historyTab').addEventListener('click', () => {
                document.getElementById('quickEntrySection').classList.add('hidden');
                document.getElementById('todayDataSection').classList.add('hidden');
                document.getElementById('historyPanel').classList.remove('hidden');
                
                document.getElementById('quickEntryTab').classList.remove('tab-active');
                document.getElementById('todayDataTab').classList.remove('tab-active');
                document.getElementById('historyTab').classList.add('tab-active');
                
                // 默认显示当天的历史记录
                showTodayHistoryRecords();
            });
            
            // 保存编辑历史记录记录按钮
            document.getElementById('saveTodayDataBtn').addEventListener('click', () => {
                const timestamp = document.getElementById('saveTodayDataBtn').dataset.timestamp;
                const entry = getEditTodayDataFormValues();
                
                // 验证是否有至少一个号码的数量大于0
                const hasSizes = Object.values(entry.sizes).some(count => count > 0);
                if (!hasSizes) {
                    showToast('error', '失败', '请至少设置一个号码的数量');
                    return;
                }
                
                if (dataStore.updateHistoryEntry(timestamp, entry)) {
                    closeModal('editTodayDataModal');
                    showToast('success', '成功', '记录更新成功');
                    
                    // 重新显示历史记录和当日数据
                    showTodayHistoryRecords();
                    dataStore.updateTodayDataTable();
                } else {
                    showToast('error', '失败', '记录更新失败，请检查记录是否存在');
                }
            });
            
            // 删除历史记录按钮
            document.getElementById('deleteTodayDataBtn').addEventListener('click', () => {
                const timestamp = document.getElementById('deleteTodayDataBtn').dataset.timestamp;
                
                showConfirmDialog(
                    '确认删除',
                    '您确定要删除这条数据吗？此操作不可撤销。',
                    () => {
                        if (dataStore.deleteHistoryEntry(timestamp)) {
                            closeModal('editTodayDataModal');
                            showToast('success', '成功', '记录删除成功');
                            
                            // 重新显示历史记录和当日数据
                            showTodayHistoryRecords();
                            dataStore.updateTodayDataTable();
                        } else {
                            showToast('error', '失败', '记录删除失败，请检查记录是否存在');
                        }
                    }
                );
            });
            
            // 取消确认按钮
            document.getElementById('cancelConfirmBtn').addEventListener('click', () => {
                closeModal('confirmDialog');
            });
            
            // 确认按钮
            document.getElementById('confirmBtn').addEventListener('click', () => {
                const confirmCallback = document.getElementById('confirmBtn').dataset.callback;
                if (confirmCallback && window[confirmCallback]) {
                    window[confirmCallback]();
                    delete window[confirmCallback];
                }
                closeModal('confirmDialog');
            });
            
            // 确认录入预览按钮
            document.getElementById('confirmEntryPreviewBtn').addEventListener('click', () => {
                if (dataStore.confirmEntry()) {
                    closeModal('entryPreviewModal');
                    showToast('success', '成功', '数据录入成功');
                } else {
                    showToast('error', '失败', '数据录入失败');
                }
            });
        }

        // 关闭模态框
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // 显示提示消息
        function showToast(type, title, message) {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            
            // 设置图标和颜色
            switch (type) {
                case 'success':
                    toastIcon.className = 'fa fa-check-circle text-green-500 text-lg';
                    break;
                case 'error':
                    toastIcon.className = 'fa fa-exclamation-circle text-red-500 text-lg';
                    break;
                case 'warning':
                    toastIcon.className = 'fa fa-exclamation-triangle text-yellow-500 text-lg';
                    break;
                case 'info':
                default:
                    toastIcon.className = 'fa fa-info-circle text-blue-500 text-lg';
                    break;
            }
            
            // 设置标题和消息
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            
            // 显示提示
            toast.classList.remove('translate-x-full');
            
            // 3秒后隐藏
            setTimeout(() => {
                toast.classList.add('translate-x-full');
            }, 3000);
        }

        // 显示确认对话框
        function showConfirmDialog(title, message, callback) {
            const confirmDialog = document.getElementById('confirmDialog');
            const confirmDialogTitle = document.getElementById('confirmDialogTitle');
            const confirmDialogMessage = document.getElementById('confirmDialogMessage');
            const confirmBtn = document.getElementById('confirmBtn');
            
            // 设置标题和消息
            confirmDialogTitle.textContent = title;
            confirmDialogMessage.textContent = message;
            
            // 设置确认按钮回调
            const callbackName = 'confirmCallback_' + Date.now();
            window[callbackName] = callback;
            confirmBtn.dataset.callback = callbackName;
            
            // 显示对话框
            confirmDialog.classList.remove('hidden');
        }

        // 打开编辑历史记录模态框
        function openEditHistoryEntryModal(entry) {
            const modal = document.getElementById('editTodayDataModal');
            const editType = document.getElementById('editType');
            const editModel = document.getElementById('editModel');
            const editColor = document.getElementById('editColor');
            const editBoxQuantity = document.getElementById('editBoxQuantity');
            const editSizeQuantities = document.getElementById('editSizeQuantities');
            const editTotalBoxes = document.getElementById('editTotalBoxes');
            const editTotalQuantity = document.getElementById('editTotalQuantity');
            const saveTodayDataBtn = document.getElementById('saveTodayDataBtn');
            const deleteTodayDataBtn = document.getElementById('deleteTodayDataBtn');
            
            // 设置基本信息
            editType.value = entry.type;
            editModel.value = entry.model;
            editColor.value = entry.color;
            editBoxQuantity.value = entry.boxQuantity;
            
            // 设置时间戳
            saveTodayDataBtn.dataset.timestamp = entry.timestamp;
            deleteTodayDataBtn.dataset.timestamp = entry.timestamp;
            
            // 清空号码数量编辑框
            editSizeQuantities.innerHTML = '';
            
            // 添加号码数量编辑框
            dataStore.sizes.forEach(size => {
                const count = entry.sizes[size] || 0;
                const container = document.createElement('div');
                container.className = 'flex flex-col';
                container.innerHTML = `
                    <label class="text-xs text-gray-500 mb-1">${size}</label>
                    <input type="number" class="input-field edit-size-quantity" data-size="${size}" min="0" value="${count}">
                `;
                editSizeQuantities.appendChild(container);
            });
            
            // 更新总箱数和总数量
            updateEditTotalBoxesAndQuantity();
            
            // 添加号码数量变化事件
            document.querySelectorAll('.edit-size-quantity').forEach(input => {
                input.addEventListener('change', updateEditTotalBoxesAndQuantity);
                input.addEventListener('input', function() {
                    // 确保值为非负整数
                    this.value = Math.max(0, parseInt(this.value) || 0);
                    updateEditTotalBoxesAndQuantity();
                });
            });
            
            // 添加每箱数量变化事件
            editBoxQuantity.addEventListener('change', updateEditTotalBoxesAndQuantity);
            
            // 显示模态框
            modal.classList.remove('hidden');
        }
        
        // 打开编辑当日数据模态框（按索引）- 功能已禁用
        function openEditTodayDataModal(index) {
            showToast('info', '提示', '当日数据编辑功能已禁用，仅支持查看');
        }
        
        // 更新编辑模态框中的总箱数和总数量
        function updateEditTotalBoxesAndQuantity() {
            const editBoxQuantity = parseInt(document.getElementById('editBoxQuantity').value) || 0;
            const sizeInputs = document.querySelectorAll('.edit-size-quantity');
            
            let totalBoxes = 0;
            const sizes = {};
            
            sizeInputs.forEach(input => {
                const size = input.dataset.size;
                const count = parseInt(input.value) || 0;
                sizes[size] = count;
                totalBoxes += count;
            });
            
            const totalQuantity = totalBoxes * editBoxQuantity;
            
            document.getElementById('editTotalBoxes').textContent = totalBoxes;
            document.getElementById('editTotalQuantity').textContent = totalQuantity;
        }

        // 获取编辑数据表单的值
        function getEditTodayDataFormValues() {
            const type = document.getElementById('editType').value;
            const model = document.getElementById('editModel').value;
            const color = document.getElementById('editColor').value;
            const boxQuantity = parseInt(document.getElementById('editBoxQuantity').value) || 0;
            const sizeInputs = document.querySelectorAll('.edit-size-quantity');
            
            const sizes = {};
            let totalBoxes = 0;
            
            sizeInputs.forEach(input => {
                const size = input.dataset.size;
                const count = parseInt(input.value) || 0;
                sizes[size] = count;
                totalBoxes += count;
            });
            
            const totalQuantity = totalBoxes * boxQuantity;
            
            return {
                type,
                model,
                color,
                boxQuantity,
                sizes,
                totalBoxes,
                totalQuantity
            };
        }

        // 显示历史记录查询结果
        function displayHistoryResults(results) {
            const resultsContainer = document.getElementById('historyResults');
            
            // 如果没有结果，显示提示信息
            if (!results || results.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        没有找到匹配的记录
                    </div>
                `;
                return;
            }
            
            // 清空结果容器
            resultsContainer.innerHTML = '';
            
            // 添加结果卡片
            results.forEach(entry => {
                const card = document.createElement('div');
                card.className = 'card mb-4';
                
                // 格式化日期
                const date = new Date(entry.timestamp);
                const dateString = date.toLocaleDateString('zh-CN');
                const timeString = date.toLocaleTimeString('zh-CN');
                
                // 构建号码数量HTML
                let sizesHtml = '';
                dataStore.sizes.forEach(size => {
                    const count = entry.sizes[size] || 0;
                    if (count > 0) {
                        sizesHtml += `
                            <div class="flex items-center justify-between">
                                <span class="text-sm">${size}码</span>
                                <span class="text-sm font-medium">${count}箱 (${count * entry.boxQuantity}双)</span>
                            </div>
                        `;
                    }
                });
                
                // 构建卡片内容
                let cardContent = `
                    <div class="flex items-center justify-between mb-2">
                        <div>
                            <h4 class="font-medium">${entry.type} - ${entry.model} - ${entry.color}</h4>
                            <p class="text-xs text-gray-500">${dateString} ${timeString}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-medium">总箱数: ${entry.totalBoxes}</p>
                            <p class="text-sm font-medium">总数量: ${entry.totalQuantity}双</p>
                        </div>
                    </div>
                    <div class="border-t border-gray-100 pt-2 mt-2">
                        <p class="text-xs text-gray-500 mb-1">每箱数量: ${entry.boxQuantity}双</p>
                        <div class="grid grid-cols-2 gap-2">
                            ${sizesHtml}
                        </div>
                    </div>
                `;
                
                // 添加操作栏（编辑和删除按钮）
                cardContent += `
                    <div class="flex justify-end gap-2 mt-3 pt-3 border-t border-gray-100">
                        <button class="btn-secondary text-sm edit-history-entry" data-timestamp="${entry.timestamp}">
                            <i class="fa fa-pencil"></i> 编辑
                        </button>
                        <button class="btn-danger text-sm delete-history-entry" data-timestamp="${entry.timestamp}">
                            <i class="fa fa-trash"></i> 删除
                        </button>
                    </div>
                `;
                
                card.innerHTML = cardContent;
                resultsContainer.appendChild(card);
            });
            
            // 导出Excel按钮已移至查询按钮旁边，此处不再动态创建
            
            // 添加编辑和删除事件监听
            document.querySelectorAll('.edit-history-entry').forEach(button => {
                button.addEventListener('click', () => {
                    const timestamp = button.dataset.timestamp;
                    const entry = dataStore.historyData.find(item => item.timestamp === timestamp);
                    
                    if (entry) {
                        openEditHistoryEntryModal(entry);
                    } else {
                        showToast('error', '失败', '未找到该记录');
                    }
                });
            });
            
            document.querySelectorAll('.delete-history-entry').forEach(button => {
                button.addEventListener('click', () => {
                    const timestamp = button.dataset.timestamp;
                    const entry = dataStore.historyData.find(item => item.timestamp === timestamp);
                    
                    if (entry) {
                        showConfirmDialog(
                            '确认删除',
                            `您确定要删除 ${entry.type} - ${entry.model} - ${entry.color} 的入库记录吗？`,
                            () => {
                                if (dataStore.deleteHistoryEntry(timestamp)) {
                                    showToast('success', '成功', '记录删除成功');
                                    // 重新显示历史记录
                                    showTodayHistoryRecords();
                                } else {
                                    showToast('error', '失败', '记录删除失败');
                                }
                            }
                        );
                    } else {
                        showToast('error', '失败', '未找到该记录');
                    }
                });
            });
        }

        // 下载CSV文件
        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // 导出为Excel格式（实际上是CSV，但包含多个工作表的信息）
        function exportToExcel(results) {
            // 生成主数据表
            let mainDataCSV = dataStore.exportHistoryResultsToCSV(results);
            
            // 生成数据透视表
            let pivotDataCSV = generatePivotTableCSV(results);
            
            // 组合两个工作表的数据
            let excelContent = `数据来源：鞋子仓库管理系统\n导出时间：${new Date().toLocaleString()}\n\n`;
            excelContent += `【详细记录】\n${mainDataCSV}\n\n`;
            excelContent += `【数据透视表 - 按型体配色汇总】\n${pivotDataCSV}`;
            
            // 下载文件
            const blob = new Blob([excelContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            
            // 设置文件名
            const startDate = document.getElementById('historyStartDate').value || '开始';
            const endDate = document.getElementById('historyEndDate').value || '结束';
            link.setAttribute('download', `鞋子入库记录_${startDate}_${endDate}.csv`);
            
            link.href = url;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // 生成数据透视表CSV
        function generatePivotTableCSV(results) {
            // 按型体和颜色分组数据
            const pivotData = {};
            
            results.forEach(entry => {
                const key = `${entry.type}-${entry.model}-${entry.color}`;
                
                if (!pivotData[key]) {
                    pivotData[key] = {
                        type: entry.type,
                        model: entry.model,
                        color: entry.color,
                        totalBoxes: 0,
                        totalQuantity: 0,
                        sizeDetails: {}
                    };
                    
                    // 初始化所有号码的数量为0
                    dataStore.sizes.forEach(size => {
                        pivotData[key].sizeDetails[size] = 0;
                    });
                }
                
                // 累加总箱数和总数量
                pivotData[key].totalBoxes += entry.totalBoxes;
                pivotData[key].totalQuantity += entry.totalQuantity;
                
                // 累加每个号码的数量
                for (const [size, count] of Object.entries(entry.sizes)) {
                    if (count > 0) {
                        pivotData[key].sizeDetails[size] += count * entry.boxQuantity;
                    }
                }
            });
            
            // 创建CSV表头
            let csv = '货品类型,型体,颜色,总箱数,总数量';
            dataStore.sizes.forEach(size => {
                csv += `,${size}码数量`;
            });
            csv += '\n';
            
            // 添加数据行
            for (const key in pivotData) {
                const item = pivotData[key];
                csv += `${item.type},${item.model},${item.color},${item.totalBoxes},${item.totalQuantity}`;
                
                dataStore.sizes.forEach(size => {
                    csv += `,${item.sizeDetails[size] || 0}`;
                });
                
                csv += '\n';
            }
            
            return csv;
        }
        
        // 显示录入预览模态框
        function showEntryPreviewModal() {
            const modal = document.getElementById('entryPreviewModal');
            
            // 重新从DOM获取最新值，确保数据同步
            const latestType = document.getElementById('entryType').value;
            const latestModel = document.getElementById('entryModel').value;
            const latestColor = document.getElementById('entryColor').value;
            const latestBoxQuantity = parseInt(document.getElementById('entryBoxQuantity').value) || 27;
            
            // 更新dataStore中的值
            dataStore.currentEntry.type = latestType;
            dataStore.currentEntry.model = latestModel;
            dataStore.currentEntry.color = latestColor;
            dataStore.currentEntry.boxQuantity = latestBoxQuantity;
            
            // 设置基本信息
            document.getElementById('previewType').textContent = latestType;
            document.getElementById('previewModel').textContent = latestModel;
            document.getElementById('previewColor').textContent = latestColor;
            document.getElementById('previewBoxQuantity').textContent = latestBoxQuantity;
            
            // 计算总箱数和总数量
            let totalBoxes = 0;
            let totalQuantity = 0;
            
            // 清空号码表格
            const sizeTable = document.getElementById('previewSizeTable');
            sizeTable.innerHTML = '';
            
            // 添加号码数据行
            dataStore.sizes.forEach(size => {
                const count = dataStore.currentEntry.sizes[size] || 0;
                if (count > 0) {
                    totalBoxes += count;
                    const quantity = count * dataStore.currentEntry.boxQuantity;
                    totalQuantity += quantity;
                    
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="border border-gray-200 px-3 py-2 text-sm font-medium text-gray-900">${size}</td>
                        <td class="border border-gray-200 px-3 py-2 text-center text-sm text-gray-900">${count}</td>
                        <td class="border border-gray-200 px-3 py-2 text-center text-sm text-gray-900">${quantity}</td>
                    `;
                    sizeTable.appendChild(row);
                }
            });
            
            // 设置总箱数和总数量
            document.getElementById('previewTotalBoxes').textContent = totalBoxes;
            document.getElementById('previewTotalQuantity').textContent = totalQuantity;
            
            // 显示模态框
            modal.classList.remove('hidden');
        }
        
        // 显示今日的历史记录
        function showTodayHistoryRecords() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            document.getElementById('historyStartDate').valueAsDate = today;
            document.getElementById('historyEndDate').valueAsDate = new Date();
            
            const results = dataStore.searchHistory(
                document.getElementById('historyTypeFilter').value,
                document.getElementById('historyModelFilter').value,
                document.getElementById('historyColorFilter').value,
                document.getElementById('historySizeFilter').value,
                document.getElementById('historyStartDate').value,
                document.getElementById('historyEndDate').value
            );
            
            displayHistoryResults(results);
        }
    </script>


</body></html>